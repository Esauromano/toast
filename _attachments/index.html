<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Toast</title>
    <link rel="stylesheet" href="style/main.css" type="text/css">
  </head>
  <body>
    <h1>Toast - Join a Channel (or Create one):</h1>
    <form id="new_channel" action="#">
      
      <p><label for="name">Channel Name</label> <input type="text" name="name" value="" id="name"></p>
      <p><label for="message">Initial Message</label> <input type="text" name="message" value="" id="message">
      </p>
      <p><input type="submit" value="Go &rarr;"></p>
    </form>
    <ul id="channels"></ul>
  </body>
  <script src="/_utils/script/json2.js"></script>
  <script src="/_utils/script/jquery.js"></script>
  <script src="/_utils/script/jquery.couch.js"></script>
  <script src="vendor/couchapp/jquery.couchapp.js"></script>
  <script type="text/javascript" charset="utf-8">
    $.CouchApp(function(app) {
      app.view("channels",{group_level: 1, success: function(json) {
        $("#channels").html(json.rows.map(function(row) {
          return '<li><a href="channel.html#'+ 
          row.key
          +'">'+row.key+'</a> '+row.value+' messages</li>';
        }).join(''));
      }});
      
      $("#new_channel").submit(function() {
        var name = $('#name').val();
        var message = $('#message').val();
        app.db.saveDoc({channel:name,message:message});
        return false;
      });
    });
  </script>
</html>
